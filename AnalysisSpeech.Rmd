---
title: "Analysis Speech"
author: "Tom Offrede"
date: "2022-09-15"
output:
  html_document:
    toc: true
    toc_float: 
      collapsed: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, include=FALSE}
library(tidyverse)
library(lme4)

`%!in%` <- Negate(`%in%`)

folder <- "C:/Users/offredet/Documents/1HU/ExperimentEyes/Data/All/"
files <- list.files(folder, "RData")
fileConv <- files[grepl("Conversation", files)]
fileBase <- files[grepl("Baseline", files)]

load(paste0(folder, fileConv))
load(paste0(folder, fileBase))

dac <- dac %>%
  mutate_at(c("turnDur", "turn", "f0mean", "robPrevf0", "gapDur"), as.numeric) %>%
  mutate_at(c("speaker", "condition", "Order", "task"), as.factor) %>% 
  group_by(speaker) %>% 
  mutate(turnDurNormal = (turnDur - min(turnDur)) / (max(turnDur) - min(turnDur)),
         f0z = (f0mean - min(f0mean)) / (max(f0mean) - min(f0mean)),
         gapDurNormal = (gapDur - min(gapDur)) / (max(gapDur) - min(gapDur)),
         f0DiffNormal = (f0Diff - min(f0Diff)) / (max(f0Diff) - min(f0Diff)),
         robf0Normal = (robPrevf0 - min(robPrevf0, na.rm=TRUE)) / (max(robPrevf0, na.rm=TRUE) - min(robPrevf0, na.rm=TRUE))) %>% 
  ungroup()

dab <- dab %>%
  mutate_at(c("condition"), as.factor)
```

## Conditions:
**GA: Gaze Aversion; the robot produced gaze aversion. Experimental condition.**
**NG: No Gaze aversion; the robot stared constantly at the human. Control condition.**

# Between-Turn Gap Duration

```{r}
ggplot(dac, aes(condition, gapDurNormal))+
  geom_boxplot()

ggplot(dac, aes(turnNormal, gapDurNormal))+
  geom_point()+
  facet_wrap(~condition)+
  geom_smooth(method="lm")
```


* There is a `condition` effect: between-turn gaps are longer in the `NG` condition (in line with our  hypothesis)
* There is a `turn` effect: gaps are longer the further into the conversation in both conditions (makes sense: questions get harder and more intimate)
* There is a `condition:turn` effect: gaps get longer throughout the conversation in the `GA` condition than in the `NG` condition.

```{r}
dac$condition <- relevel(dac$condition, ref="NG")
summary(g1 <- lmer(gapDurNormal ~ condition * turnNormal + (1 + condition | speaker), dac))
```

# Turn Duration

```{r}
ggplot(dac %>% filter(!grepl("Robot", speaker)), aes(condition, turnDurNormal))+
  geom_boxplot()

ggplot(dac %>% filter(!grepl("Robot", speaker)), aes(turnNormal, turnDurNormal))+
  geom_point()+
  facet_wrap(~condition)+
  geom_smooth(method="lm")
```


There is a `turn` effect: turns get longer the further into the interaction. There is also a `condition:turn` effect: in the `GA` condition, people tend to have longer turns across the interaction than the increase in turn length in the `NG` condition.

This is in line with our hypothesis: we expected people in the `GA` condition to feel more comfortable and speak more.

```{r}
dac$condition <- relevel(dac$condition, ref="NG")
summary(t1 <- lmer(turnDurNormal ~ condition * turnNormal + (1 + condition | speaker), dac %>% filter(!grepl("Robot", speaker))))
```

# f0 during conversation

## Using the f0 from the IPUs of the robot's previous turn as predictors for the f0 of the IPUs of the human's current turn

```{r}
ggplot(dac, aes(robf0Normal, f0z))+
  geom_point()+
  facet_wrap(~condition)+
  geom_smooth(method="lm")
```

There seems to be an interaction effect between `robot's previous f0` and `condition`:

* **In `NG` condition:** higher robot's previous f0 = higher human's current f0
* **In `GA` condition:** no effect of robot's previous f0 on human's current f0

This means that people converged their f0 towards the robot more in the `NG` than in the `GA` condition.

```{r}
dac$condition <- relevel(dac$condition, ref="GA")
summary(f1 <- lmer(f0z ~ robf0Normal : condition + (1 + condition | speaker), dac %>% filter(!grepl("Robot", speaker))))
```

Now check how robust this is with `robPreviousf0Mock`:

Here no effect shows up, so we can probably take the finding above as (somewhat?) robust.

```{r}
dac$condition <- relevel(dac$condition, ref="GA")
summary(f1 <- lmer(f0mean ~ (robPrevf0Mock + condition)^2 + (1 + condition | speaker), dac %>% filter(!grepl("Robot", speaker))))
dac$condition <- relevel(dac$condition, ref="GA")
summary(f2 <- lmer(f0z ~ (robPrevf0Mock + condition)^2 + (1 + condition | speaker), dac %>% filter(!grepl("Robot", speaker))))
```


## Using the difference between the human's mean f0 in the current turn and the robot's mean f0 in the preceding turn

```{r, include=FALSE}
dat <- dac %>% 
  filter(!duplicated(tgroup))
```


```{r}
ggplot(dat, aes(condition, f0DiffNormal))+
  geom_boxplot()
ggplot(dat, aes(condition, f0Diff))+
  geom_boxplot()

ggplot(dat, aes(turnNormal, f0Diff))+
  geom_point()+
  facet_wrap(~condition)+
  geom_smooth(method="lm")
ggplot(dat, aes(turnNormal, f0DiffNormal))+
  geom_point()+
  facet_wrap(~condition)+
  geom_smooth(method="lm")
```

Using this method we don't see any effect on f0.

```{r}
summary(ft1 <- lmer(f0DiffNormal ~ condition * turnNormal + (1 + condition | speaker), dat))
```

# f0 during baseline

```{r}
ggplot(dab, aes(robPrevf0, f0mean))+
  geom_point()+
  facet_wrap(~condition)
```

The model below would suggest that the f0 of the first robot the person talked to influenced the person's f0 when they were producing speech alone afterwards, but that there was no effect of condition.

```{r}
dab$condition <- relevel(dab$condition, ref="GA")
summary(fb2 <- lmer(f0mean ~ robPrevf0 * condition + (1 + condition | speaker), dab))
```

However, if we remove `condition` from the model, the effect of `robot's previous f0` disappears.

```{r}
summary(fb1 <- lmer(f0mean ~ robPrevf0 + (1 | speaker), dab))
```

Also, if we test the effect of some mock data (f0 of the robot the person hasn't interacted with yet), `robot's previous f0` also shows an effect. This happens both if we do or don't include `condition` in the model. So we can disregard the model on f0 of baseline.

```{r}
summary(fbM <- lmer(f0mean ~ robPrevf0Mock * condition + (1 + condition | speaker), dab))
```

If we use f0z instead of f0, the results look even less robust. We can assume there was no lasting convergence effect.